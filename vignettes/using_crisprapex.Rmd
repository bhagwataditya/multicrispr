---
title: "Using crisprapex"
author: Aditya Bhagwat, Mette Bentsen, Johannes Graumann, Mario Looso, 
output: BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{finding_flank_cas9s}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


# Introduction

crisprapex makes the design of CRISPR-APEX experiments easier.
Serving to the specifics of such experiments, these functions:

* Find a CRISPR **set** to target a genomic **set**.
* Allow to target the **flanks** of genomic loci rather than loci themselves.
* Are **efficient**, building on top of data.table and Biostrings.

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "    #", 
  cache = TRUE
)
```

```{r load}
library(magrittr)
library(crisprapex)
```


# Find cas9 sites specific for TBS flanks

```{r findcas9s}
bedfile      <- system.file('extdata/SRF_sites.bed', package = 'crisprapex')
bsgenome     <- BSgenome.Mmusculus.UCSC.mm10::Mmusculus
targetranges <- read_bed(bedfile, bsgenome) %>% flank_fourways()
cas9ranges   <- find_specific_cas9ranges(targetranges, mismatch = 0)
```

# Score cas9s and filter on score

```{r scorecas9s}
cas9ranges$score_rs1 <- score_cas9ranges(cas9ranges, ruleset = 1)
if (assertive.reflection::is_unix() & reticulate::py_module_available('azimuth')){
  reticulate::use_condaenv('default')
  cas9ranges$score_rs2 <- score_cas9s(cas9ranges, ruleset = 2)
  message('\tFilter for scores > 0.4')
  cas9ranges %<>% extract(cas9ranges$score > 0.4)
}
cmessage(sprintf('\t\t%d cas9 seqs across %d ranges', length(unique(cas9ranges$seqs)), length(cas9ranges)))
```

